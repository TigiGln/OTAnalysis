<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>model.class_curve &mdash; OTAnalysis  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> OTAnalysis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">OTAnalysis</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">OTAnalysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>model.class_curve</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for model.class_curve</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">File describing the instance class of the curved objects</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">savgol_filter</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">UnivariateSpline</span>

<div class="viewcode-block" id="Curve"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve">[docs]</a><span class="k">class</span> <span class="nc">Curve</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class that instantiates curved objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=unbalanced-tuple-unpacking</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">dict_segments</span><span class="p">,</span> <span class="n">pulling_length</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialization attributes of the object and launch the functions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">file</span>
        <span class="n">bead</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_header</span> <span class="o">=</span> <span class="n">header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span> <span class="o">=</span> <span class="n">dict_segments</span> <span class="c1"># Liste d&#39;objets segments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span><span class="p">{</span><span class="s1">&#39;bead&#39;</span><span class="p">:</span> <span class="n">bead</span><span class="p">,</span> <span class="s1">&#39;cell&#39;</span><span class="p">:</span> <span class="n">cell</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;treat_supervised&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">========================================================================</span><span class="se">\n</span><span class="s2">&quot;</span>
       
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">========================================================================</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="c1"># self.delta_t()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identification_main_axis</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalization_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_incomplete</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_retraction_troncated</span><span class="p">(</span><span class="n">pulling_length</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_incomplete</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">========================================================================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">========================================================================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">calcul_baseline</span><span class="p">(</span><span class="s2">&quot;Press&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calcul_std</span><span class="p">(</span><span class="s2">&quot;Press&quot;</span><span class="p">)</span>
        
        <span class="c1">#self.detected_max_force()</span>
        <span class="c1"># #self.check_alignment_curve()</span>
        <span class="c1">#self.compare_baseline_start_end()</span>
        
        <span class="c1">#self.curve_approach_analyze()</span>
        <span class="c1">#self.graphics[&#39;graph_approach&#39;] = plt.show()</span>
        <span class="c1">#self.curve_return_analyze()</span>
        <span class="c1">#self.graphics[&#39;graph_retraction&#39;] = plt.show()</span>

    <span class="c1">################################################################################################</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determines what is displayed when the object is printed</span>

<span class="sd">        :return:</span>
<span class="sd">            self.bead: used ball</span>
<span class="sd">            self.cell: cell number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bead</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell</span>

    <span class="c1">###############################################################################################</span>

<div class="viewcode-block" id="Curve.delta_t"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.delta_t">[docs]</a>    <span class="k">def</span> <span class="nf">delta_t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        calculation of the delta t on the whole curve</span>

<span class="sd">        :return:</span>
<span class="sd">            delta_t: float</span>
<span class="sd">                time variation on the whole curve</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">delta_t</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">delta_t</span> <span class="o">+=</span> <span class="n">segment</span><span class="o">.</span><span class="n">real_time</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">delta_t</span></div>

    <span class="c1">###############################################################################################</span>

<div class="viewcode-block" id="Curve.identification_main_axis"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.identification_main_axis">[docs]</a>    <span class="k">def</span> <span class="nf">identification_main_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determination of the main axis of the manipulation</span>

<span class="sd">        :return:</span>
<span class="sd">            main_axis: str</span>
<span class="sd">                direction related to phi angle with an interval of -pi +/- epsilon</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scanner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters_header</span><span class="p">[</span><span class="s1">&#39;header_global&#39;</span><span class="p">][</span><span class="s1">&#39;settings.segment.0.xy-scanner.scanner&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters_header</span><span class="p">[</span><span class="s1">&#39;header_global&#39;</span><span class="p">][</span><span class="s1">&#39;settings.segment.0.direction.phi&#39;</span><span class="p">])</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;main_axis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">main_axis</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1"># la convention pour +/- est : ou est la cellule par rapport a la bille</span>
        <span class="c1"># EXPLICITER LA CONVENTION ICI</span>
        <span class="k">if</span> <span class="n">scanner</span> <span class="o">==</span> <span class="s1">&#39;sample-scanner&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">+</span><span class="n">epsilon</span><span class="p">):</span>
                <span class="n">main_axis</span> <span class="o">=</span> <span class="s2">&quot;-x&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="o">-</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">epsilon</span><span class="p">):</span>
                <span class="n">main_axis</span> <span class="o">=</span> <span class="s2">&quot;+x&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="o">-</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="o">+</span><span class="n">epsilon</span><span class="p">):</span>
                <span class="n">main_axis</span> <span class="o">=</span> <span class="s2">&quot;-y&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="o">-</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="o">+</span><span class="n">epsilon</span><span class="p">):</span>
                <span class="n">main_axis</span> <span class="o">=</span> <span class="s2">&quot;+y&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">main_axis</span> <span class="o">=</span> <span class="s2">&quot;Angle error&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">main_axis</span> <span class="o">=</span> <span class="s2">&quot;Error on the scanner&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">main_axis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">main_axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;sign&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">main_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">main_axis</span><span class="p">)</span></div>

    <span class="c1">################################################################################################</span>

<div class="viewcode-block" id="Curve.calcul_baseline"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.calcul_baseline">[docs]</a>    <span class="k">def</span> <span class="nf">calcul_baseline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_segment</span><span class="p">,</span> <span class="n">corrected_data</span><span class="o">=</span><span class="kc">False</span> <span class="p">,</span><span class="n">axe</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">range_data</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determination of the baseline of the curve by calculating</span>
<span class="sd">        the average over the first or the last 200 points</span>

<span class="sd">        :parameters:</span>
<span class="sd">            name_segment: str</span>
<span class="sd">                name of the segment on which to search the baseline</span>
<span class="sd">        :return:</span>
<span class="sd">            basseline: float</span>
<span class="sd">                value of the baseline as a function of the segment</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">baseline</span> <span class="o">=</span> <span class="mi">0</span> 
        <span class="k">if</span> <span class="n">axe</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">axe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span>
        <span class="n">segment</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="n">name_segment</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;motion&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">corrected_data</span><span class="p">:</span>
                <span class="n">data_analyze</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_analyze</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">data</span>
            <span class="k">if</span> <span class="n">name_segment</span> <span class="o">==</span> <span class="s2">&quot;Press&quot;</span><span class="p">:</span>
                <span class="n">baseline</span> <span class="o">=</span> <span class="n">data_analyze</span><span class="p">[</span><span class="n">axe</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">range_data</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;baseline_press&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="n">baseline</span> <span class="o">*</span> <span class="mf">1e12</span><span class="p">,</span> <span class="s1">&#39;.3E&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">name_segment</span> <span class="o">==</span> <span class="s2">&quot;Pull&quot;</span><span class="p">:</span>
                <span class="n">baseline</span> <span class="o">=</span> <span class="n">data_analyze</span><span class="p">[</span><span class="n">axe</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">][</span><span class="o">-</span><span class="n">range_data</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">baseline</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">baseline</span></div>

    <span class="c1">###############################################################################################</span>

<div class="viewcode-block" id="Curve.calcul_std"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.calcul_std">[docs]</a>    <span class="k">def</span> <span class="nf">calcul_std</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_segment</span><span class="p">,</span> <span class="n">corrected_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axe</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">range_data</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determination of the standard deviation of the curve by calculating</span>
<span class="sd">        over the first or the last 200 points</span>
<span class="sd">        :parameters:</span>
<span class="sd">            name_segment: str</span>
<span class="sd">                name of the segment on which to search the baseline</span>
<span class="sd">            range_data: int</span>
<span class="sd">                nb point for the calcul</span>
<span class="sd">        :return:</span>
<span class="sd">            std: float</span>
<span class="sd">                value of the standard deviation as a function of the segment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">std</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">axe</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">axe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span>
        <span class="n">segment</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="n">name_segment</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;motion&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">corrected_data</span><span class="p">:</span>
                <span class="n">data_analyze</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_analyze</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">data</span>
            <span class="k">if</span> <span class="n">name_segment</span> <span class="o">==</span> <span class="s2">&quot;Press&quot;</span><span class="p">:</span>
                <span class="n">std</span> <span class="o">=</span> <span class="n">data_analyze</span><span class="p">[</span><span class="n">axe</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">range_data</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;std_press&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="s1">&#39;.3E&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">name_segment</span> <span class="o">==</span> <span class="s2">&quot;Pull&quot;</span><span class="p">:</span>
                <span class="n">std</span> <span class="o">=</span> <span class="n">data_analyze</span><span class="p">[</span><span class="n">axe</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">][</span><span class="o">-</span><span class="n">range_data</span><span class="p">:]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">std</span></div>

    <span class="c1">###############################################################################################</span>

<div class="viewcode-block" id="Curve.normalization_data"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.normalization_data">[docs]</a>    <span class="k">def</span> <span class="nf">normalization_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Normalize the data on the main axis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(&quot;normalization_data&quot;)</span>
        <span class="n">num_segment</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">time_start</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">choice_axe</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">]</span>
        <span class="n">main_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">axe</span> <span class="ow">in</span> <span class="n">choice_axe</span><span class="p">:</span>
            <span class="n">baseline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calcul_baseline</span><span class="p">(</span><span class="s2">&quot;Press&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">axe</span><span class="p">)</span>
            <span class="n">column</span> <span class="o">=</span> <span class="n">axe</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span>
            <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">data</span><span class="p">[[</span><span class="n">column</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e12</span>

        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">segment</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">num_segment</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.duration&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">time_start</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;seriesTime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;seriesTime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">time_start</span><span class="p">)</span>
            <span class="n">num_segment</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">stiffness</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters_header</span><span class="p">[</span><span class="s1">&#39;calibrations&#39;</span><span class="p">][</span><span class="n">main_axis</span> <span class="o">+</span> <span class="s1">&#39;Signal1_stiffness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; N/m&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;stiffness (N/m)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="n">stiffness</span><span class="p">,</span> <span class="s1">&#39;.3E&#39;</span><span class="p">)</span>
            <span class="n">stiffness</span> <span class="o">=</span> <span class="n">stiffness</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1e12</span><span class="o">/</span><span class="mf">1e9</span><span class="p">)</span>
            <span class="n">distances</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e9</span>
            <span class="n">forces</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
            <span class="n">data_corrected_stiffness</span> <span class="o">=</span> <span class="n">distances</span> <span class="o">-</span> <span class="n">forces</span> <span class="o">/</span> <span class="n">stiffness</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data_corrected_stiffness</span> <span class="o">-</span> <span class="n">data_corrected_stiffness</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="c1">## (nm)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s2">&quot;sign&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;+&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curve_reversal</span><span class="p">()</span></div>

    <span class="c1">###############################################################################################</span>

<div class="viewcode-block" id="Curve.curve_reversal"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.curve_reversal">[docs]</a>    <span class="k">def</span> <span class="nf">curve_reversal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        According to the main axis transforms all values into their inverse to return the curve</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(&quot;curve_reversal&quot;)</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;xSignal1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;xSignal1&#39;</span><span class="p">]</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;ySignal1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;ySignal1&#39;</span><span class="p">]</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;zSignal1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;zSignal1&#39;</span><span class="p">]</span></div>
            <span class="c1"># if self.features[&quot;main_axis&quot;][&#39;axe&#39;] == &#39;x&#39;:</span>
            <span class="c1">#     segment.corrected_data[&#39;ySignal1&#39;] = -segment.corrected_data[&#39;ySignal1&#39;]</span>
            <span class="c1"># else:</span>
            <span class="c1">#     segment.corrected_data[&#39;xSignal1&#39;] = -segment.corrected_data[&#39;xSignal1&#39;]</span>
            <span class="c1"># segment.corrected_data[&#39;zSignal1&#39;] = -segment.corrected_data[&#39;zSignal1&#39;]</span>

    <span class="c1">###############################################################################################</span>

<div class="viewcode-block" id="Curve.retrieve_data_curve"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.retrieve_data_curve">[docs]</a>    <span class="k">def</span> <span class="nf">retrieve_data_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_data</span><span class="o">=</span><span class="s2">&quot;data_original&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Visualization of the curves on the three axes with Matplotlib</span>

<span class="sd">        :parameters:</span>
<span class="sd">            type_data: str</span>
<span class="sd">                Determined the dataframe to be used for visualization</span>
<span class="sd">                (original data or corrected data)</span>
<span class="sd">            y: str</span>
<span class="sd">                data on the axe Y for the plot</span>
<span class="sd">        :return:</span>
<span class="sd">            plot show</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">type_data</span> <span class="o">==</span> <span class="s2">&quot;data_original&quot;</span><span class="p">:</span>
                <span class="n">data_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data_total</span><span class="p">,</span> <span class="n">segment</span><span class="o">.</span><span class="n">data</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data_total</span><span class="p">,</span><span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">data_total</span></div>

    <span class="c1">##############################################################################################</span>

<div class="viewcode-block" id="Curve.check_alignment_curve"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.check_alignment_curve">[docs]</a>    <span class="k">def</span> <span class="nf">check_alignment_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold_align</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determination of the curve well aligned on the main axis</span>

<span class="sd">        :parameters:</span>
<span class="sd">            force: float</span>
<span class="sd">                application force on the cell (Default: 10e-12)</span>
<span class="sd">        :return:</span>
<span class="sd">            check: bool</span>
<span class="sd">                return True if the curve is not well aligned</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(&quot;check_alignment_curve&quot;)</span>
        <span class="n">force_min</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">force_min_exp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detected_min_force</span><span class="p">()</span>
        <span class="n">force_min_exp</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">force_min_exp</span> <span class="o">*</span> <span class="p">(</span><span class="n">threshold_align</span><span class="o">/</span><span class="mi">100</span><span class="p">))</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s2">&quot;Press&quot;</span><span class="p">]</span>
        <span class="n">force_threshold</span> <span class="o">=</span> <span class="n">threshold_align</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.setpoint.value&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="n">force_threshold</span> <span class="o">=</span> <span class="n">force_threshold</span> <span class="o">*</span> <span class="mf">1e12</span>
        <span class="k">if</span> <span class="n">force_threshold</span> <span class="o">&lt;</span> <span class="n">force_min_exp</span><span class="p">:</span>
            <span class="n">force_min</span> <span class="o">=</span> <span class="n">force_min_exp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">force_min</span> <span class="o">=</span> <span class="n">force_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;threshold alignement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">force_min</span>
        <span class="n">dict_align</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">dict_align</span><span class="p">[</span><span class="n">segment</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">check_alignment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;axe&#39;</span><span class="p">],</span> <span class="n">force_min</span><span class="p">)</span>
        <span class="n">dict_align_final</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dict_align</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;AL&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dict_align_final</span><span class="p">:</span>
                <span class="n">dict_align_final</span><span class="p">[</span><span class="s1">&#39;AL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;AL&#39;</span><span class="p">]</span>
                <span class="n">dict_align_final</span><span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dict_align_final</span><span class="p">[</span><span class="s1">&#39;AL&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;AL&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">dict_align_final</span><span class="p">[</span><span class="s1">&#39;AL&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">dict_align_final</span><span class="p">[</span><span class="s1">&#39;AL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;AL&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">dict_align_final</span><span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NaN&#39;</span><span class="p">:</span>
                    <span class="n">dict_align_final</span><span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dict_align_final</span><span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">]):</span>
                        <span class="n">dict_align_final</span><span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dict_align_final</span></div>

    <span class="c1">##############################################################################################</span>

<div class="viewcode-block" id="Curve.compare_baseline_start_end"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.compare_baseline_start_end">[docs]</a>    <span class="k">def</span> <span class="nf">compare_baseline_start_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Comparison of the beginning and the end of the curve to know</span>
<span class="sd">        if there is a break of adhesion and return to normal</span>

<span class="sd">        :return:</span>
<span class="sd">            :check: bool</span>
<span class="sd">                returns true if start and end similarly</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;compare_baseline&quot;</span><span class="p">)</span>
        <span class="n">baseline_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calcul_baseline</span><span class="p">(</span><span class="s2">&quot;Press&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">line_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calcul_baseline</span><span class="p">(</span><span class="s2">&quot;Pull&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">std_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calcul_std</span><span class="p">(</span><span class="s2">&quot;Press&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="c1"># print(&#39;baseline_start: &#39;, baseline_start)</span>
        <span class="c1"># print(&#39;std_start: &#39;, std_start)</span>
        <span class="c1"># print(&#39;line_end: &#39;, line_end)</span>
        <span class="c1"># print(line_end)</span>
        <span class="c1"># print(baseline_start - std_start*tolerance)</span>
        <span class="c1"># print(baseline_start + std_start*tolerance)</span>
        <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">baseline_start</span> <span class="o">-</span> <span class="n">std_start</span><span class="o">*</span><span class="n">tolerance</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">line_end</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">baseline_start</span> <span class="o">+</span> <span class="n">std_start</span><span class="o">*</span><span class="n">tolerance</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">baseline_end Ok</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;baseline_end Ok&quot;</span><span class="p">)</span>
            <span class="n">check</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;automatic_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">baseline_start</span> <span class="o">+</span> <span class="n">std_start</span><span class="o">*</span><span class="n">tolerance</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">line_end</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Baseline_end NO</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Baseline_end NO&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;automatic_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ITU&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Baseline_end NO</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Baseline_end NO&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;automatic_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;RE&quot;</span>
              
        <span class="k">return</span> <span class="n">check</span></div>

    <span class="c1">#############################################################################################</span>

<div class="viewcode-block" id="Curve.detected_min_force"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.detected_min_force">[docs]</a>    <span class="k">def</span> <span class="nf">detected_min_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determination on the approach segment of the ball,</span>
<span class="sd">        if the contact between the ball and the cell has been correctly executed</span>

<span class="sd">        :parameters:</span>
<span class="sd">            tolerance: int</span>
<span class="sd">                pourcentage de tolrance pour la force exprimentale</span>

<span class="sd">        :return:</span>
<span class="sd">            contact: bool</span>
<span class="sd">                True if the contact is within the maximum force range</span>
<span class="sd">            data_max: float</span>
<span class="sd">                maximum value of the contact segment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;detected_max_force: &quot;</span><span class="p">)</span>
        <span class="n">main_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span>
        <span class="n">data_min_curve</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">index_data_min_curve</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">time_min_curve</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="n">main_axis</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">]</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;seriesTime&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">data_min_curve</span> <span class="o">&gt;</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]:</span>
                <span class="n">time_min_curve</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
                <span class="n">data_min_curve</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
                <span class="n">index_data_min_curve</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
        <span class="n">data_min_approach</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">index_data_min</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s2">&quot;Press&quot;</span><span class="p">]</span>
        <span class="n">force</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s2">&quot;segment-settings.setpoint.value&quot;</span><span class="p">])</span>
        <span class="n">force</span> <span class="o">=</span> <span class="o">-</span><span class="n">force</span> <span class="o">*</span> <span class="mf">1e12</span>
        <span class="n">interval</span> <span class="o">=</span>  <span class="n">force</span> <span class="o">*</span> <span class="n">tolerance</span><span class="o">/</span> <span class="mi">100</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="n">main_axis</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">]</span>
        <span class="n">data_min_approach</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">force</span><span class="p">,</span> <span class="n">data_min_approach</span><span class="p">,</span> <span class="n">rel_tol</span> <span class="o">=</span> <span class="n">tolerance</span><span class="p">):</span>
            <span class="n">index_data_min</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index_data</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">-</span> <span class="n">interval</span><span class="p">)</span> <span class="o">&gt;</span>  <span class="n">data</span><span class="p">[</span><span class="n">index_data</span><span class="p">]</span>  <span class="o">&gt;</span> <span class="p">(</span><span class="n">force</span> <span class="o">+</span> <span class="n">interval</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">index_data</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">data_min_approach</span><span class="p">:</span>
                        <span class="n">data_min_approach</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">index_data</span><span class="p">]</span>
                        <span class="n">index_data_min</span> <span class="o">=</span> <span class="n">index_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;force_min_press&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index_data_min</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span> <span class="p">:</span> <span class="n">data_min_approach</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;force_min_curve&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index_data_min_curve</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span> <span class="p">:</span> <span class="n">data_min_curve</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;time_min_curve&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index_data_min_curve</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">time_min_curve</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">data_min_curve</span></div>

    <span class="c1">#############################################################################################</span>

<div class="viewcode-block" id="Curve.fit_model_approach"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.fit_model_approach">[docs]</a>    <span class="k">def</span> <span class="nf">fit_model_approach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_corrected_stiffness</span><span class="p">,</span> <span class="n">contact_point</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">baseline</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determination contact model between the bead and the cell</span>

<span class="sd">        :parameters:</span>
<span class="sd">            model: str</span>
<span class="sd">                model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fit</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_corrected_stiffness</span><span class="p">)</span>
        <span class="n">fit</span><span class="p">[</span><span class="n">fit</span><span class="o">&lt;</span><span class="n">contact_point</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
            <span class="n">fit</span><span class="p">[</span><span class="n">fit</span><span class="o">&gt;</span><span class="n">contact_point</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">fit</span><span class="p">[</span><span class="n">fit</span><span class="o">&gt;</span><span class="n">contact_point</span><span class="p">]</span><span class="o">-</span><span class="n">contact_point</span><span class="p">)</span> <span class="o">+</span> <span class="n">baseline</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;sphere&quot;</span><span class="p">:</span>
            <span class="n">fit</span><span class="p">[</span><span class="n">fit</span><span class="o">&gt;</span><span class="n">contact_point</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">fit</span><span class="p">[</span><span class="n">fit</span><span class="o">&gt;</span><span class="n">contact_point</span><span class="p">]</span><span class="o">-</span><span class="n">contact_point</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">baseline</span>
        <span class="k">return</span> <span class="n">fit</span></div>

    <span class="c1">#############################################################################################</span>
<div class="viewcode-block" id="Curve.fit_curve_approach"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.fit_curve_approach">[docs]</a>    <span class="k">def</span> <span class="nf">fit_curve_approach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">main_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s2">&quot;Press&quot;</span><span class="p">]</span>
        <span class="n">force_data</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="n">main_axis</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">]</span>
        <span class="n">distance_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">])</span>
        <span class="n">index_contact</span><span class="p">,</span> <span class="n">line_pos_threshold</span> <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">retrieve_contact</span><span class="p">(</span><span class="n">force_data</span><span class="p">,</span> <span class="s2">&quot;Press&quot;</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;threshold_press&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_pos_threshold</span>
        <span class="n">baseline</span> <span class="o">=</span> <span class="n">force_data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">300</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="n">force_data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">300</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="c1"># y0</span>
        <span class="n">x_1</span> <span class="o">=</span> <span class="n">distance_data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">distance_data</span><span class="p">)</span><span class="o">-</span><span class="n">index_contact</span><span class="p">]</span>
        <span class="n">y_1</span> <span class="o">=</span> <span class="n">force_data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">force_data</span><span class="p">)</span><span class="o">-</span><span class="n">index_contact</span><span class="p">]</span>
        <span class="n">x_2</span> <span class="o">=</span> <span class="n">distance_data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">distance_data</span><span class="p">)</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span>
        <span class="n">y_2</span> <span class="o">=</span> <span class="n">force_data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">force_data</span><span class="p">)</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span>
        <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_2</span> <span class="o">-</span> <span class="n">y_1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_2</span> <span class="o">-</span> <span class="n">x_1</span><span class="p">)</span>
        <span class="n">contact_point</span> <span class="o">=</span> <span class="n">distance_data</span><span class="p">[</span><span class="n">index_contact</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="c1"># x0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;contact_point&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index_contact</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span> <span class="p">:</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index_contact</span><span class="p">]}</span>
        <span class="c1"># guesses_initiaux = [10**(9), 10**3, 1]</span>
        <span class="n">initial_guesses_accuracy</span> <span class="o">=</span> <span class="p">[</span><span class="n">contact_point</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">baseline</span><span class="p">]</span>
        <span class="n">f_parameters</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_model_approach</span><span class="p">,</span> <span class="n">distance_data</span><span class="p">,</span> <span class="n">force_data</span><span class="p">,</span> <span class="n">initial_guesses_accuracy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f_parameters</span><span class="p">)</span>
        <span class="c1">#print(f_parameters)</span>
        <span class="n">fitted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_model_approach</span><span class="p">(</span><span class="n">distance_data</span><span class="p">,</span> <span class="n">f_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">f_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">f_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="c1">#y_smooth_approach = Curve.smooth(force_data)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;fitted_Press&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitted</span>
        <span class="c1"># self.graphics[&#39;y_smooth_Press&#39;] = y_smooth_approach</span>
        <span class="k">return</span> <span class="n">f_parameters</span><span class="p">,</span> <span class="n">fitted</span></div>

        <span class="c1"># gmodel = Model(self.fit_model_approach)</span>
        <span class="c1"># params = Parameters()</span>
        <span class="c1"># params.add(&#39;x0&#39;, value=x0)</span>
        <span class="c1"># params.add(&#39;a&#39;, value=a)</span>
        <span class="c1"># params.add(&#39;b&#39;, value=b)</span>
        <span class="c1"># result = gmodel.fit(Y, X, params=params)</span>
        <span class="c1"># print(result)</span>

    <span class="c1">##################################################################################################</span>

<div class="viewcode-block" id="Curve.retrieve_contact"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.retrieve_contact">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">retrieve_contact</span><span class="p">(</span><span class="n">data_analyze</span><span class="p">,</span> <span class="n">segment</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">retour</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;retrieve_contact&#39;</span><span class="p">)</span>
        <span class="n">list_index_contact</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">index_contact</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">optical_effect</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">line_pos_threshold</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">segment</span> <span class="o">==</span> <span class="s2">&quot;Press&quot;</span><span class="p">:</span>
            <span class="n">baseline</span> <span class="o">=</span> <span class="n">data_analyze</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">200</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">std</span> <span class="o">=</span>  <span class="n">data_analyze</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">200</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
            <span class="n">line_pos_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_analyze</span><span class="p">),</span><span class="n">std</span><span class="o">*</span><span class="n">tolerance</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">baseline</span> <span class="o">=</span> <span class="n">data_analyze</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">data_analyze</span><span class="p">)</span><span class="o">-</span><span class="mi">300</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">std</span> <span class="o">=</span>  <span class="n">data_analyze</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">data_analyze</span><span class="p">)</span><span class="o">-</span><span class="mi">300</span><span class="p">:]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
            <span class="n">line_pos_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_analyze</span><span class="p">),</span><span class="n">std</span><span class="o">*</span><span class="n">tolerance</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_analyze</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">baseline</span> <span class="o">-</span> <span class="n">std</span> <span class="o">&lt;</span> <span class="n">data_analyze</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">baseline</span> <span class="o">+</span> <span class="n">std</span><span class="p">:</span>
                <span class="n">list_index_contact</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data_analyze</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">baseline</span> <span class="o">+</span> <span class="n">std</span> <span class="o">*</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">optical_effect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">segment</span> <span class="o">==</span> <span class="s2">&quot;Press&quot;</span><span class="p">:</span>
            <span class="n">index_contact</span> <span class="o">=</span> <span class="n">list_index_contact</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index_contact</span> <span class="o">=</span> <span class="n">list_index_contact</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">retour</span> <span class="o">==</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">index_contact</span><span class="p">,</span> <span class="n">line_pos_threshold</span>
        <span class="k">return</span> <span class="n">index_contact</span><span class="p">,</span> <span class="n">optical_effect</span></div>

    <span class="c1">###################################################################################################</span>

<div class="viewcode-block" id="Curve.curve_approach_analyze"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.curve_approach_analyze">[docs]</a>    <span class="k">def</span> <span class="nf">curve_approach_analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">bead_ray</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>
        <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">young</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">error_young</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#error_contact = None</span>
        <span class="n">slope</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;model&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
            <span class="n">f_parameters</span><span class="p">,</span> <span class="n">fitted</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_curve_approach</span><span class="p">(</span><span class="n">tolerance</span><span class="p">)</span>
            <span class="c1">#contact = np.round(f_parameters[0], decimals=1)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">f_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">f_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="c1">#error_contact = np.around(error[1], decimals=2)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
                <span class="n">slope</span> <span class="o">=</span> <span class="n">f_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="n">error_young</span> <span class="o">=</span> <span class="n">error</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;slope (pN/nm)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="n">slope</span><span class="p">,</span> <span class="s1">&#39;.2E&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;error (pN/nm)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="n">error_young</span><span class="p">,</span> <span class="s1">&#39;.2E&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;Slope (pN/nm) = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; +/-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_young</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Slope (pN/nm) = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; +/-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_young</span><span class="p">))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sphere&#39;</span><span class="p">:</span>
                <span class="n">young</span> <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">determine_young_modulus</span><span class="p">(</span><span class="n">f_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eta</span><span class="p">,</span> <span class="n">bead_ray</span><span class="p">)</span>
                <span class="n">error_young</span> <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">determine_young_modulus</span><span class="p">(</span><span class="n">error</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eta</span><span class="p">,</span> <span class="n">bead_ray</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">young</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">young</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">error_young</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;young (Pa)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">young</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;error young (Pa)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">error_young</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;Young modulus (Pa) = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">young</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; +/-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_young</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Young modulus (Pa) = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">young</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; +/-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_young</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;Model error&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;Trace not processed&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model error&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trace not processed&quot;</span><span class="p">)</span>

            <span class="n">length_segment</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s1">&#39;Press&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.length&#39;</span><span class="p">])</span>
            <span class="n">time_segment</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s1">&#39;Press&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.duration&#39;</span><span class="p">])</span>
            <span class="n">vitesse</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">length_segment</span><span class="o">/</span><span class="n">time_segment</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s1">&#39;Press&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;vitesse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vitesse</span></div>
        

    <span class="c1">###################################################################################################</span>
<div class="viewcode-block" id="Curve.fit_model_retraction"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.fit_model_retraction">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fit_model_retraction</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">point_release</span><span class="p">,</span> <span class="n">endline</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">fit</span><span class="p">[</span><span class="n">fit</span><span class="o">&lt;</span><span class="n">point_release</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">fit</span><span class="p">[</span><span class="n">fit</span><span class="o">&lt;</span><span class="n">point_release</span><span class="p">]</span><span class="o">-</span><span class="n">point_release</span><span class="p">)</span> <span class="o">+</span> <span class="n">endline</span>
        <span class="n">fit</span><span class="p">[</span><span class="n">fit</span><span class="o">&gt;=</span><span class="n">point_release</span><span class="p">]</span> <span class="o">=</span> <span class="n">endline</span>
        <span class="k">return</span> <span class="n">fit</span></div>

    <span class="c1">##################################################################################################</span>

<div class="viewcode-block" id="Curve.fit_curve_retraction"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.fit_curve_retraction">[docs]</a>    <span class="k">def</span> <span class="nf">fit_curve_retraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seuil_jump_force</span><span class="p">,</span> <span class="n">seuil_nb_point</span><span class="p">,</span> <span class="n">seuil_jump_distance</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">main_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s1">&#39;Pull&#39;</span><span class="p">]</span>
        <span class="n">force_data</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="n">main_axis</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">]</span>
        <span class="n">distance_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">])</span>
        <span class="n">time_data</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
        <span class="n">mean_final_points</span> <span class="o">=</span> <span class="n">force_data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">force_data</span><span class="p">)</span><span class="o">-</span><span class="mi">300</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">std_final_points</span> <span class="o">=</span> <span class="n">force_data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">force_data</span><span class="p">)</span><span class="o">-</span><span class="mi">200</span><span class="p">:]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="c1">#line_pos_threshold = np.full(len(force_data),std_final_points*tolerance)</span>
        <span class="n">endline</span> <span class="o">=</span> <span class="n">mean_final_points</span> <span class="o">-</span> <span class="n">std_final_points</span><span class="c1"># y0</span>
        <span class="n">y_smooth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">force_data</span><span class="p">,</span> <span class="n">time_data</span><span class="p">,</span> <span class="mi">151</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1">######################################################################</span>
        <span class="c1"># n=8</span>
        <span class="c1"># derive = self.derivation(y_smooth, time_data, n)</span>
        <span class="c1"># #derive = np.diff(y_smooth)/np.diff(time_data)</span>
        <span class="c1"># derive =  np.append(derive, derive[-n//2:])</span>
        <span class="c1"># derive = np.insert(derive, [0], derive[0:int(n/2)], axis=0)</span>
        <span class="c1"># #derive =  np.append(derive, derive[-1])</span>
        <span class="c1"># derive_smooth = Curve.smooth(derive, distance_data, 101, 2)</span>
        <span class="c1"># m=4</span>
        <span class="c1"># derive_seconde =  self.derivation(derive_smooth, time_data, m)</span>
        <span class="c1"># derive_seconde =  np.append(derive_seconde, derive_seconde[-m//2:])</span>
        <span class="c1"># derive_seconde = np.insert(derive_seconde, [0], derive_seconde[0:int(m/2)], axis=0)</span>
        <span class="c1"># #derive_seconde =np.diff(derive_smooth)/np.diff(time_data)</span>
        <span class="c1"># #derive_seconde =  np.append(derive_seconde, derive_seconde[-1])</span>
        <span class="c1"># derive_sec_smooth = Curve.smooth(derive_seconde, distance_data, 101, 2)</span>
        <span class="c1"># derive_sec_smooth_neg = np.negative(derive_seconde)</span>
        <span class="c1"># max_derive_seconde = derive_sec_smooth.max()</span>
        <span class="c1"># max_derive_seconde_neg = derive_sec_smooth_neg.max()</span>
        <span class="c1"># peaks, _ = find_peaks(derive_sec_smooth, height=10000, prominence=1)</span>
        <span class="c1"># #peaks = peaks[peaks &gt; 1000] - n</span>
        <span class="c1"># peaks2, _2 = find_peaks(derive_sec_smooth_neg, height=10000, prominence=1)</span>
        <span class="c1"># peaks2 = peaks2[peaks2 &gt; 1000] - n</span>

        
        <span class="c1"># # idx = []</span>
        <span class="c1"># # for index_data in range(0, len(derive_smooth), 1):</span>
        <span class="c1"># #     if -1.5 &lt; derive_smooth[index_data] &lt; 1.5:</span>
        <span class="c1"># #         idx.append(index_data)</span>
        <span class="c1"># #print(&#39;index: &#39;, idx)</span>

        <span class="c1"># #index_force_max_derive = np.where(derive_smooth == derive_smooth.max())[0][0]</span>
        <span class="c1"># # index_min = np.where(derive_sec_smooth == derive_sec_smooth.min())[0][0]</span>
        <span class="c1"># # #index_force_max = idx[0]+18</span>
        <span class="c1"># # index_max = np.where(derive_sec_smooth == derive_sec_smooth[:index_min-10].max())[0][0]</span>
        <span class="c1"># # index_min_2 = np.where(derive_sec_smooth == derive_sec_smooth[:index_max].min())[0][0]</span>
        
        <span class="c1"># # # index_force_max_derive2 = np.where(derive_sec_smooth == derive_sec_smooth.max())[0][0]</span>
        <span class="c1"># # #index_force_max_derive = index_force_max_derive</span>
        <span class="c1"># if len(peaks2) &gt; 0:</span>
        <span class="c1">#     self.graphics[&#39;index_max_derive&#39;] = peaks2[-1]</span>

        <span class="c1"># if len(peaks) &gt; 0:</span>
        <span class="c1">#     self.graphics[&#39;index_max_derive2&#39;] = peaks[-1]</span>
        <span class="c1"># #plt.plot(time_data, derive_smooth)</span>
        <span class="c1"># #plt.plot(time_data, derive_sec_smooth)</span>
        <span class="c1"># y_smoothing = y_smooth*1000</span>
        
        <span class="c1"># #plt.hlines(0,0,len(time_data)*(time_data[1]-time_data[0]))</span>
        <span class="c1"># # # plt.plot(distance_data[index_force_max_derive], derive_smooth[index_force_max_derive], marker=&#39;D&#39;, color=&#39;cyan&#39;)</span>
        <span class="c1"># # # index_max_2 = np.where(derive_smooth == derive_smooth[index_force_max_derive+10:].max())[0][0]</span>
        <span class="c1"># # # self.graphics[&#39;index_max_derive2&#39;] = index_max_2</span>
        <span class="c1"># # plt.plot(time_data[index_min], y_smoothing[index_min], marker=&#39;D&#39;, color=&#39;red&#39;)</span>
        <span class="c1"># # plt.plot(time_data[index_min_2], y_smoothing[index_min_2], marker=&#39;D&#39;, color=&#39;green&#39;)</span>
        <span class="c1"># # plt.plot(time_data[index_force_max-1], derive_smooth[index_force_max-1], marker=&#39;D&#39;, color=&#39;purple&#39;)</span>
        <span class="c1"># # plt.plot(time_data[index_force_max], derive_smooth[index_force_max], marker=&#39;D&#39;, color=&#39;cyan&#39;)</span>
        <span class="c1"># plt.plot(time_data, y_smoothing)</span>
        <span class="c1"># plt.plot(time_data[peaks], y_smoothing[peaks], &quot;D&quot;)</span>
        <span class="c1"># #plt.plot(time_data[peaks], derive_sec_smooth[peaks], &quot;x&quot;)</span>
        <span class="c1"># plt.plot(time_data[peaks2], y_smoothing[peaks2], &quot;o&quot;)</span>
        <span class="c1"># plt.savefig(&#39;graph_test/graph_&#39; + self.file + &#39;.png&#39;)</span>
        <span class="c1">#plt.plot(time_data[index_force_max], y_smoothing[index_force_max], marker=&#39;D&#39;, color=&#39;blue&#39;)</span>
        <span class="c1">#plt.plot(time_data[index_force_max_derive2], derive_sec_smooth[index_force_max_derive2], marker=&#39;D&#39;, color=&#39;red&#39;)</span>
        <span class="c1">#plt.show()</span>
        <span class="c1">##########################################################################</span>
        <span class="n">index_release</span><span class="p">,</span> <span class="n">line_pos_threshold</span> <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">retrieve_contact</span><span class="p">(</span><span class="n">force_data</span><span class="p">,</span> <span class="s2">&quot;Pull&quot;</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;threshold_pull&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_pos_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;point_release&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index_release</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index_release</span><span class="p">]}</span>
        <span class="n">x_1</span> <span class="o">=</span> <span class="n">distance_data</span><span class="p">[</span><span class="n">index_release</span><span class="o">-</span><span class="mi">20</span><span class="p">]</span>
        <span class="n">y_1</span> <span class="o">=</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index_release</span><span class="o">-</span><span class="mi">20</span><span class="p">]</span>
        <span class="n">x_2</span> <span class="o">=</span> <span class="n">distance_data</span><span class="p">[</span><span class="n">index_release</span><span class="o">-</span><span class="mi">100</span><span class="p">]</span>
        <span class="n">y_2</span> <span class="o">=</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index_release</span><span class="o">-</span><span class="mi">100</span><span class="p">]</span>
        <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_1</span> <span class="o">-</span> <span class="n">y_2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_1</span> <span class="o">-</span> <span class="n">x_2</span><span class="p">)</span>
        <span class="n">point_release</span> <span class="o">=</span> <span class="n">distance_data</span><span class="p">[</span><span class="n">index_release</span><span class="p">]</span><span class="c1"># x0</span>
        <span class="n">index_return_end_line</span> <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">retrieve_retour_line_end</span><span class="p">(</span><span class="n">y_smooth</span><span class="p">,</span> <span class="n">mean_final_points</span><span class="p">,</span> <span class="n">std_final_points</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span>
        <span class="c1"># initial_guess = [10**(9), point_release, 10**3]</span>
        <span class="n">initial_guesses_accuracy</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">point_release</span><span class="p">,</span> <span class="n">endline</span><span class="p">]</span>
        <span class="n">f_parameters</span><span class="p">,</span> <span class="n">f_covariance</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Curve</span><span class="o">.</span><span class="n">fit_model_retraction</span><span class="p">,</span> <span class="n">distance_data</span><span class="p">,</span> <span class="n">force_data</span><span class="p">,</span> <span class="n">initial_guesses_accuracy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f_parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;Pente (pN/nm)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f_parameters</span><span class="p">)</span>
        <span class="n">fitted</span> <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">fit_model_retraction</span><span class="p">(</span><span class="n">distance_data</span><span class="p">,</span> <span class="n">f_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">f_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;fitted_Pull&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics</span><span class="p">[</span><span class="s1">&#39;y_smooth_Pull&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_smooth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;point_return_endline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;NaN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;NaN&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;point_transition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;NaN&#39;</span><span class="p">,</span> <span class="s1">&#39;value (pN)&#39;</span><span class="p">:</span> <span class="s1">&#39;NaN&#39;</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;automatic_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;automatic_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;zarbi&#39;</span><span class="p">:</span>
            <span class="n">force_max</span> <span class="o">=</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index_release</span><span class="p">:</span><span class="n">index_release</span><span class="o">+</span><span class="mi">1500</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">index_force_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">force_data</span> <span class="o">==</span> <span class="n">force_max</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">force_max</span> <span class="o">&lt;=</span> <span class="n">seuil_jump_force</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;automatic_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NAD&#39;</span>                
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">index_return_end_line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;point_return_endline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index_return_end_line</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index_return_end_line</span><span class="p">]}</span>
                    <span class="n">index_transition</span> <span class="o">=</span> <span class="n">index_return_end_line</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.num-points&#39;</span><span class="p">])</span><span class="o">//</span><span class="mi">1000</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;point_transition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index_transition</span><span class="p">,</span> <span class="s1">&#39;value (pN)&#39;</span><span class="p">:</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index_transition</span><span class="p">]}</span>
                    <span class="n">force_max</span> <span class="o">=</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index_release</span><span class="p">:</span><span class="n">index_return_end_line</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                    <span class="n">index_force_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">force_data</span> <span class="o">==</span> <span class="n">force_max</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">jump_force_start_pull</span> <span class="o">=</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index_force_max</span><span class="p">]</span> <span class="o">-</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index_release</span><span class="p">]</span>
                    <span class="n">jump_distance_start_pull</span> <span class="o">=</span> <span class="n">distance_data</span><span class="p">[</span><span class="n">index_force_max</span><span class="p">]</span> <span class="o">-</span> <span class="n">distance_data</span><span class="p">[</span><span class="n">index_release</span><span class="p">]</span>
                    <span class="n">jump_nb_points</span> <span class="o">=</span> <span class="n">index_return_end_line</span> <span class="o">-</span> <span class="n">index_force_max</span>
                    <span class="n">jump_distance_end_pull</span> <span class="o">=</span> <span class="n">distance_data</span><span class="p">[</span><span class="n">index_release</span><span class="p">]</span> <span class="o">-</span> <span class="n">distance_data</span><span class="p">[</span><span class="n">index_return_end_line</span><span class="p">]</span>
                    <span class="n">jump_force_end_pull</span> <span class="o">=</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index_release</span><span class="p">]</span> <span class="o">-</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index_return_end_line</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;jump_force_start_pull (pN)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jump_force_start_pull</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;jump_distance_start_pull (nm)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jump_distance_start_pull</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;jump_distance_end_pull (nm)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jump_distance_end_pull</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;jump_force_end_pull (pN)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jump_force_end_pull</span>
                    <span class="k">if</span> <span class="n">jump_nb_points</span> <span class="o">&lt;</span> <span class="n">seuil_nb_point</span> <span class="ow">and</span> <span class="n">jump_distance_end_pull</span> <span class="o">&lt;</span> <span class="n">seuil_jump_distance</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;automatic_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;AD&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;automatic_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;FTU&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">force_max</span> <span class="o">=</span> <span class="n">force_data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">index_force_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">force_data</span> <span class="o">==</span> <span class="n">force_max</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;force_max_pull&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index_force_max</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">force_max</span><span class="p">}</span></div>
    
             

    <span class="c1">####################################################################################################################################</span>

<div class="viewcode-block" id="Curve.derivation"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.derivation">[docs]</a>    <span class="k">def</span> <span class="nf">derivation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_data</span><span class="p">,</span> <span class="n">time_data</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">derivation</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">force_data</span><span class="p">)</span><span class="o">-</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">derivation</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">force_data</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">time_data</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">time_data</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">]))</span>
            <span class="c1">#derivation.append((distance_data[index+n//2]- distance_data[index-n//2])/(n * (time_data[index+1] - time_data[index])))</span>
        <span class="n">derivation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">derivation</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">derivation</span></div>

    <span class="c1">#####################################################################################################################################</span>
<div class="viewcode-block" id="Curve.curve_return_analyze"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.curve_return_analyze">[docs]</a>    <span class="k">def</span> <span class="nf">curve_return_analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seuil_jump_force</span><span class="p">,</span> <span class="n">seuil_nb_point</span><span class="p">,</span> <span class="n">seuil_jump_distance</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">main_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span>
        <span class="c1">#segment_go = self.dict_segments[&quot;Press&quot;]</span>
        <span class="c1">#optical_effect = Curve.retrieve_contact(segment_go.corrected_data[main_axis + &#39;Signal1&#39;], &#39;optical&#39;)</span>
        <span class="n">segment_return</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s2">&quot;Pull&quot;</span><span class="p">]</span>
        <span class="n">force_data</span> <span class="o">=</span> <span class="n">segment_return</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="n">main_axis</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">]</span>
        <span class="n">distance_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">segment_return</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">segment_return</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">force_data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">force_data</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">force_data</span><span class="p">)</span><span class="o">//</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">force_data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">force_data</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">force_data</span><span class="p">)</span><span class="o">//</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_curve_retraction</span><span class="p">(</span><span class="n">seuil_jump_force</span><span class="p">,</span> <span class="n">seuil_nb_point</span><span class="p">,</span> <span class="n">seuil_jump_distance</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span></div>
        
    <span class="c1">#####################################################################################################################################</span>

<div class="viewcode-block" id="Curve.retrieve_retour_line_end"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.retrieve_retour_line_end">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">retrieve_retour_line_end</span><span class="p">(</span><span class="n">data_analyze</span><span class="p">,</span> <span class="n">mean_final_points</span><span class="p">,</span> <span class="n">std_final_points</span><span class="p">,</span> <span class="n">nb_std</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mean_final_points</span> <span class="o">+</span> <span class="n">std_final_points</span> <span class="o">*</span> <span class="n">nb_std</span><span class="p">)</span>
        <span class="n">threshold2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mean_final_points</span> <span class="o">+</span> <span class="n">std_final_points</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span>
        <span class="c1"># print(&quot;threshold: &quot;, threshold)</span>
        <span class="c1"># print(&quot;threshold2: &quot;, threshold2)</span>
        <span class="n">list_data_return_endline</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">index_return_endline</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">data_analyze</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_analyze</span><span class="p">)</span>
        <span class="n">data_analyze_reverse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">data_analyze</span><span class="p">)</span>
        <span class="n">list_data_return_endline</span> <span class="o">=</span> <span class="n">data_analyze_reverse</span><span class="p">[(</span><span class="n">data_analyze_reverse</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data_analyze_reverse</span> <span class="o">&lt;</span> <span class="n">threshold2</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">list_data_return_endline</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">index_return_endline</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data_analyze</span> <span class="o">==</span> <span class="n">list_data_return_endline</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1">#index_return_endline = len(data_analyze) - index_return_endline</span>
        <span class="k">return</span> <span class="n">index_return_endline</span></div>

    <span class="c1">######################################################################################################################################</span>

<div class="viewcode-block" id="Curve.determine_young_modulus"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.determine_young_modulus">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">determine_young_modulus</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">bead_ray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Young modulus calculation</span>

<span class="sd">        :parameters:</span>
<span class="sd">            k: float</span>
<span class="sd">                directing coefficient of the slope</span>
<span class="sd">            eta: float</span>
<span class="sd">                compressibility constant</span>
<span class="sd">            bead_ray: float</span>
<span class="sd">                size of the ball radius</span>
<span class="sd">        </span>
<span class="sd">        :return:</span>
<span class="sd">            young:float</span>
<span class="sd">                young module</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indentation_depth</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># la profondeur d&#39;indentation (m)</span>
         <span class="c1"># eta = ratio de Poisson (adimensionnel)</span>
        <span class="n">young</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="mi">3</span><span class="o">/</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">bead_ray</span> <span class="o">*</span> <span class="n">indentation_depth</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># radius in nm</span>
        <span class="k">return</span> <span class="n">young</span></div>

    <span class="c1">######################################################################################################################################</span>

<div class="viewcode-block" id="Curve.segment_retraction_troncated"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.segment_retraction_troncated">[docs]</a>    <span class="k">def</span> <span class="nf">segment_retraction_troncated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pulling_length</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checking the length of the last segment</span>

<span class="sd">        :parameters:</span>
<span class="sd">            pulling_length: int</span>
<span class="sd">                Percentage of length to accept the curve </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># segment = self.dict_segments[&#39;Press&#39;]</span>
        <span class="c1"># nb_point_segment = segment.header_segment[&#39;.num-points&#39;]</span>
        <span class="c1"># print(nb_point_segment)</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s1">&#39;Pull&#39;</span><span class="p">]</span>
        <span class="n">nb_point_segment</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.num-points&#39;</span><span class="p">])</span>
        <span class="n">size_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;main_axis&quot;</span><span class="p">][</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">])</span>
        <span class="n">check_segment_troncated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">nb_point_segment</span> <span class="o">==</span> <span class="n">size_data</span><span class="p">:</span>
            <span class="n">check_segment_troncated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nb_point_segment</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">pulling_length</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span> <span class="o">&lt;=</span> <span class="n">size_data</span><span class="p">:</span>
                <span class="n">check_segment_troncated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">check_segment_troncated</span></div>

    <span class="c1">######################################################################################################################################</span>

<div class="viewcode-block" id="Curve.manage_optical_effect"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.manage_optical_effect">[docs]</a>    <span class="k">def</span> <span class="nf">manage_optical_effect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold_sup</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;optcal_effect&#39;</span><span class="p">)</span>
        <span class="n">std</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;std_press&#39;</span><span class="p">])</span>
        <span class="c1"># threshol_optical = std*threshold_sup</span>
        <span class="n">segment_press</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="p">[</span><span class="s1">&#39;Press&#39;</span><span class="p">]</span>
        <span class="c1"># segment_pull = self.dict_segments[&#39;Pull&#39;]</span>
        <span class="n">force_data_press</span> <span class="o">=</span>  <span class="n">segment_press</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;main_axis&#39;</span><span class="p">][</span><span class="s1">&#39;axe&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;Signal1&#39;</span><span class="p">]</span>
        <span class="c1"># force_data_pull =  segment_pull.corrected_data[self.features[&#39;main_axis&#39;][&#39;axe&#39;] + &#39;Signal1&#39;]</span>
        <span class="c1"># force_data_pull_inv = np.flipud(force_data_pull)</span>
        <span class="n">y_smooth</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span><span class="n">force_data_press</span><span class="p">,</span> <span class="mi">251</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="c1"># y_smooth = pd.Series(y_smooth)</span>
        <span class="n">time_data_press</span> <span class="o">=</span> <span class="n">segment_press</span><span class="o">.</span><span class="n">corrected_data</span><span class="p">[</span><span class="s1">&#39;seriesTime&#39;</span><span class="p">]</span>
        <span class="c1"># time_data_pull = segment_pull.corrected_data[&#39;seriesTime&#39;]</span>
        <span class="c1"># n=6</span>
        <span class="c1"># derive = self.derivation(y_smooth, time_data_press, n)</span>
        <span class="c1"># derive =  np.append(derive, derive[-n//2:])</span>
        <span class="c1"># derive = np.insert(derive, [0], derive[0:int(n/2)], axis=0)</span>
        <span class="c1"># derive_smooth = savgol_filter(derive, 201, 2)</span>
        <span class="c1"># # print(&#39;derive: &#39;, derive)</span>
        <span class="c1"># index_contact_point = self.features[&#39;contact_point&#39;][&#39;index&#39;] - len(y_smooth)</span>

        <span class="c1"># #print(force_data_press)</span>
        <span class="c1"># force_data_press_inv = y_smooth.iloc[::-1].reset_index(drop=True)</span>
        <span class="c1"># #force_data_press_inv.reindex(index = force_data_press_inv.index[::-1])</span>
        <span class="c1"># # print(force_data_press_inv)</span>
        <span class="c1"># # print(threshol_optical)</span>
        
        <span class="c1"># #list_point_optical_effect = []</span>
        <span class="c1"># plt.ion()</span>
        <span class="n">figure_test</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">figure_test</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_data_press</span><span class="p">,</span> <span class="n">y_smooth</span><span class="p">)</span>
        <span class="c1"># ax1.plot(time_data_press[y_smooth.argmax()], y_smooth[y_smooth.argmax()], marker=&#39;D&#39;, color=&#39;green&#39;)</span>
        <span class="c1"># ax_second = ax1.twinx()</span>
        <span class="c1"># ax_second.plot(time_data_press, derive_smooth, color=&#39;orange&#39;)</span>
        <span class="c1"># # ax2 = figure_test.add_subplot(222)</span>
        <span class="c1"># # ax2.plot(time_data_pull, force_data_pull)</span>

        <span class="c1"># # print(force_data_press_inv.argmax())</span>
        
        <span class="c1"># list_index_press_optical_effect = y_smooth[:index_contact_point][y_smooth[:index_contact_point] &gt; threshol_optical].index</span>
        <span class="c1"># list_index_optical_effect = force_data_press_inv[:index_contact_point][force_data_press_inv[:index_contact_point] &gt; threshol_optical].index</span>
        <span class="c1"># if len(list_index_press_optical_effect) &gt; 0:</span>
        <span class="c1">#     ax1.plot(time_data_press[list_index_press_optical_effect[0]], y_smooth[list_index_press_optical_effect[0]], marker=&quot;D&quot;, color=&#39;red&#39;)</span>
        <span class="c1">#     ax1.plot(time_data_press[list_index_press_optical_effect[-1]], y_smooth[list_index_press_optical_effect[-1]], marker=&#39;D&#39;, color=&#39;brown&#39;)</span>
        <span class="c1">#     ax1.plot(time_data_press[list_index_press_optical_effect], y_smooth[list_index_press_optical_effect])</span>
        
        <span class="c1">#     # if e == len(force_data_press) - force_data_press.argmax():</span>
        <span class="c1">#     #     print(&#39;hello&#39;)</span>
        <span class="c1">#     #     print(list_index_optical_effect.index(e))</span>
        <span class="c1"># # print(force_data_press[list_index_optical_effect[len(list_index_optical_effect)//2]])</span>
        <span class="c1"># # print(force_data_pull[list_index_optical_effect[len(list_index_optical_effect)//2]])</span>
        <span class="c1"># if len(list_index_optical_effect) &gt; 0 :</span>
        <span class="c1">#     force_data_pull[list_index_optical_effect] = force_data_pull[list_index_optical_effect] - force_data_press_inv[list_index_optical_effect]</span>
        <span class="c1"># #print(force_data_pull[list_index_optical_effect[len(list_index_optical_effect)//2]])</span>
        <span class="c1"># force_data_press[:index_contact_point][force_data_press[:index_contact_point] &gt;threshol_optical] = threshol_optical</span>
        <span class="c1">#############################################################################################</span>
        <span class="n">y_smooth_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y_smooth</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">force_data_press_start</span> <span class="o">=</span> <span class="n">y_smooth_test</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3000</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">force_data_press_stop</span> <span class="o">=</span> <span class="n">y_smooth_test</span><span class="p">[</span><span class="o">-</span><span class="mi">200</span><span class="p">:]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">time_data_press_start</span> <span class="o">=</span> <span class="n">time_data_press</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3000</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">time_data_press_stop</span> <span class="o">=</span> <span class="n">time_data_press</span><span class="p">[</span><span class="o">-</span><span class="mi">200</span><span class="p">:]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">a_start</span> <span class="o">=</span> <span class="p">(</span><span class="n">force_data_press_start</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">force_data_press_start</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">force_data_press_start</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">time_data_press_start</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">time_data_press_start</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">time_data_press_start</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">a_stop</span> <span class="o">=</span> <span class="p">(</span><span class="n">force_data_press_stop</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">force_data_press_stop</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">force_data_press_stop</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">time_data_press_stop</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">time_data_press_stop</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">time_data_press_stop</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">b_start</span> <span class="o">=</span> <span class="n">force_data_press_start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">a_start</span> <span class="o">*</span> <span class="n">time_data_press_start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">b_stop</span> <span class="o">=</span> <span class="n">force_data_press_stop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">a_stop</span> <span class="o">*</span> <span class="n">time_data_press_stop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># equation_start = a_start * force_data_press_start + b_start</span>
        <span class="c1"># equation_stop = a_stop * force_data_press_stop + b_stop</span>

        <span class="n">coordonne_x_point_contact_theorique</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_stop</span> <span class="o">-</span> <span class="n">b_start</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a_start</span> <span class="o">-</span> <span class="n">a_stop</span><span class="p">)</span>
        <span class="n">coordonne_y_point_contact_theorique</span> <span class="o">=</span> <span class="n">a_start</span> <span class="o">*</span> <span class="n">coordonne_x_point_contact_theorique</span> <span class="o">+</span> <span class="n">b_start</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">figure_test</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
        <span class="c1"># droite_start_x = [time_data_press_start[0], time_data_press_start[len(time_data_press_start)-1]]</span>
        <span class="n">droite_start_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">time_data_press_start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coordonne_x_point_contact_theorique</span><span class="p">]</span>
        <span class="c1"># droite_start_y = [force_data_press_start[0], force_data_press_start[len(force_data_press_start)-1]]</span>
        <span class="n">droite_start_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">force_data_press_start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coordonne_y_point_contact_theorique</span><span class="p">]</span>
        <span class="n">droite_stop_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">coordonne_x_point_contact_theorique</span><span class="p">,</span> <span class="n">time_data_press_stop</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">time_data_press_stop</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">droite_stop_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">coordonne_y_point_contact_theorique</span><span class="p">,</span> <span class="n">force_data_press_stop</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">force_data_press_stop</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="n">y_smooth_test</span><span class="p">)</span>
        <span class="n">force_data_press_test</span> <span class="o">=</span> <span class="n">y_smooth_test</span><span class="p">[</span><span class="n">y_smooth_test</span> <span class="o">&gt;</span> <span class="n">std</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">force_data_press_test</span><span class="p">)</span>
        <span class="n">time_data_press_test</span> <span class="o">=</span> <span class="n">time_data_press</span><span class="p">[</span><span class="n">force_data_press_test</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">time_data_press_test</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_data_press</span><span class="p">,</span> <span class="n">y_smooth</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_data_press_test</span><span class="p">,</span> <span class="n">force_data_press_test</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">droite_start_x</span><span class="p">,</span> <span class="n">droite_start_y</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">droite_stop_x</span><span class="p">,</span> <span class="n">droite_stop_y</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        

        <span class="c1"># ax2.plot(time_data_pull[list_index_optical_effect], force_data_pull[list_index_optical_effect])</span>
        <span class="c1">#print(force_data_pull[list_index_optical_effect])</span>
        <span class="c1"># for point in range(0, len(force_data_press_inv), 1):</span>
        <span class="c1">#     if force_data_press_inv[point] &gt; threshold_sup:</span>
        <span class="c1">#         list_point_optical_effect.append(point)</span>
        
        <span class="c1">#ax1.plot(time_data_press, force_data_press)</span>
        <span class="c1">#ax4 = figure_test.add_subplot(224)</span>
        <span class="c1"># ax2.plot(time_data_pull, force_data_pull)</span>
    

        
        <span class="c1">#ax2.plot(time_data_pull[list_index_optical_effect], force_data_pull[list_index_optical_effect])</span>

        <span class="c1"># force_data_press[list_point_optical_effect] -= force_data_press[list_point_optical_effect]</span>
        
        <span class="c1"># force_data_pull_inv[list_point_optical_effect] -= force_data_press[list_point_optical_effect]</span>

        <span class="c1"># force_data_pull = np.flipud(force_data_pull_inv)</span>
        <span class="c1"># ax3 = figure_test.add_subplot(223)</span>
        <span class="c1"># ax3.plot(time_data_press, force_data_press)</span>
        <span class="c1"># ax4 = figure_test.add_subplot(224)</span>
        <span class="c1"># ax4.plot(time_data_pull, force_data_pull)</span>
        <span class="c1">#ax4.plot(time_data_pull[list_point_optical_effect], force_data_pull[list_point_optical_effect])</span>
        <span class="c1">#ax1.plot(time_data[list_point_optical_effect], force_data_press[list_point_optical_effect])</span>

            

        <span class="c1"># if len(force_data_pull_inv) &gt; len(force_data_press):</span>
        <span class="c1">#     print(&#39;hey&#39;)</span>
        <span class="c1">#     force_data_pull_inv = force_data_pull_inv[0:len(force_data_press)]</span>
        <span class="c1"># elif len(force_data_press) &gt; len(force_data_pull_inv):</span>
        <span class="c1">#     print(&#39;yo&#39;)</span>
        <span class="c1">#     force_data_press = force_data_press[0:len(force_data_pull_inv)]</span>
        <span class="c1">#     time_data = time_data[0:len(force_data_pull_inv)] </span>
        <span class="c1"># force_data_cumul = force_data_pull_inv - force_data_press</span>

        <span class="c1"># fig2 = plt.figure()</span>

        <span class="c1"># ax1 = fig2.add_subplot(222)</span>
        <span class="c1"># ax1.plot(time_data, force_data_pull_inv)</span>
        <span class="c1"># ax1.set_title(&#39;Pull inv&#39;)</span>
        <span class="c1"># ax2 = fig2.add_subplot(221)</span>
        <span class="c1"># ax2.plot(time_data, force_data_press)</span>
        <span class="c1"># ax2.set_title(&#39;Press&#39;)</span>
        <span class="c1"># ax3 = fig2.add_subplot(223)</span>
        <span class="c1"># ax3.plot(time_data, force_data_cumul)</span>
        <span class="c1"># ax3.set_title(&#39;Cumul&#39;)</span>

        <span class="c1"># fig, ax1, ax2, ax3 = plt.subplots()</span>
        <span class="c1"># ax1.plot(time_data, force_data_pull_inv)</span>
        <span class="c1"># ax2.plot(time_data, force_data_press)</span>
        <span class="c1"># ax3.plot(time_data, force_data_cumul)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">figure_test</span></div>



    <span class="c1">######################################################################################################################################</span>

    <span class="c1">#@staticmethod</span>
<div class="viewcode-block" id="Curve.smooth"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.smooth">[docs]</a>    <span class="k">def</span> <span class="nf">smooth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">force_data</span><span class="p">,</span> <span class="n">time_data</span><span class="p">,</span> <span class="n">window_length</span> <span class="o">=</span> <span class="mi">51</span><span class="p">,</span> <span class="n">order_polynome</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allows to reduce the noise on the whole curve</span>

<span class="sd">        :parameters:</span>
<span class="sd">            force_data: Series</span>
<span class="sd">                values of y </span>
<span class="sd">            window_length: int (odd)</span>
<span class="sd">                size of the sliding window</span>

<span class="sd">        :return:</span>
<span class="sd">            values of y smoothing</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;smooth&quot;</span><span class="p">)</span>
        <span class="c1"># tck, u = splprep([time_data[::50], force_data[::50]])</span>
        <span class="c1"># print(&#39;tck: &#39;, tck)</span>
        <span class="c1"># print(&#39;u: &#39;, u)</span>
        <span class="c1"># y_smooth = splev(u, tck, der=0)</span>
        <span class="c1"># print(len(y_smooth[1]))</span>
        <span class="c1"># derive = splev(u, tck, der=1)</span>
        <span class="c1"># print(&#39;derive: &#39;, len(derive[1]))</span>
        <span class="c1">#derive = spalde(distance_data, tck)</span>
        <span class="c1"># inds = time_data.argsort()</span>
        <span class="c1"># force_data_order = force_data[inds]</span>
        <span class="n">index_max_pull</span> <span class="o">=</span> <span class="n">force_data</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">index_max_pull</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">force_data</span><span class="p">)</span><span class="o">-</span><span class="mi">1000</span><span class="p">:</span>
            <span class="c1"># print(time_data[index_max_pull:])</span>
            <span class="c1"># print(force_data[index_max_pull:])</span>
            <span class="n">spl</span> <span class="o">=</span> <span class="n">UnivariateSpline</span><span class="p">(</span><span class="n">time_data</span><span class="p">[</span><span class="n">index_max_pull</span><span class="p">:],</span> <span class="n">force_data</span><span class="p">[</span><span class="n">index_max_pull</span><span class="p">:],</span> <span class="n">s</span><span class="o">=</span><span class="mi">2049</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># #spl.set_smoothing_factor(200)</span>
        <span class="c1"># derive = spl.derivative(1)</span>
        <span class="c1"># derive_second = spl.derivative(2)</span>
        <span class="c1"># #fig, ax1 = plt.subplots()</span>


        
        <span class="c1"># # ax1.plot(time_data, force_data)</span>
        <span class="c1"># # ax1.plot(time_data,spl(time_data), &#39;r-&#39;)</span>
        
        <span class="c1"># # ax1.plot(time_data, np.zeros(len(force_data)), color=&#39;black&#39;)</span>
        <span class="c1"># # ax2 = ax1.twinx()</span>
        <span class="c1"># #ax2.plot(time_data, derive(time_data), color=&#39;green&#39;)</span>
        <span class="c1"># # ax2.plot(time_data, derive_second(time_data), color=&#39;green&#39;)</span>
        <span class="c1"># index_derive_max = derive(time_data).argmin()</span>
        <span class="c1"># index_min_derive_second = derive_second(time_data).argmin()</span>
        <span class="c1"># index_max_derive_second = derive_second(time_data).argmax() </span>
        <span class="c1"># index_min_derive_second = index_min_derive_second</span>

        <span class="c1"># self.graphics[&#39;milieu_pente&#39;] = index_derive_max</span>
        <span class="c1"># self.graphics[&#39;index_max_derive&#39;] = index_max_derive_second</span>
        <span class="c1"># self.graphics[&#39;min_derive&#39;] = index_min_derive_second</span>
        <span class="c1">#index_derive_max = np.where(derive(time_data) == derive_max)[0]</span>
        <span class="c1"># derive_neg = np.negative(derive_second(time_data))</span>
        <span class="c1"># derive_neg_max = derive_neg.max()</span>
        <span class="c1"># index_derive_neg_max = np.where(derive_neg == derive_neg_max)[0]-18</span>
        <span class="c1">#peaks, _ = find_peaks(derive(time_data), height=100000, prominence=1)</span>
        <span class="c1"># peaks = find_peaks(derive_second(time_data), prominence=20000000)</span>
        <span class="c1"># if len(peaks[0]) == 1:</span>
        <span class="c1">#     print(&#39;peaks: &#39;, peaks[0])</span>
        <span class="c1"># else:</span>
        <span class="c1">#     print(peaks[0])</span>

        <span class="c1"># peak = find_peaks_cwt(derive_second)</span>
        <span class="c1"># print(peak)</span>
        
        <span class="c1"># ax1.plot(time_data[index_derive_max], force_data[index_derive_max], &quot;D&quot;, color=&#39;orange&#39;)</span>
        <span class="c1"># ax1.plot(time_data[index_min_derive_second], force_data[index_min_derive_second], &quot;D&quot;, color=&#39;pink&#39;)</span>
        <span class="c1"># ax1.plot(time_data[index_max_derive_second], force_data[index_max_derive_second], &quot;D&quot;, color=&#39;purple&#39;)</span>
        
        <span class="c1">#ax1.plot(time_data[index_derive_neg_max[0]], force_data[index_derive_neg_max], &quot;o&quot;)</span>
        <span class="c1"># plt.plot(derive[0], derive[1])</span>
        <span class="c1">#plt.plot(time_data, force_data, linewidth=0, marker=&#39;x&#39;)</span>
        
        <span class="c1">#plt.show()</span>
        
        <span class="c1"># bspline = BSpline()</span>
        <span class="c1"># print(bspline)</span>
        <span class="c1"># print(dir(bspline))</span>
        <span class="n">y_smooth</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span><span class="n">force_data</span><span class="p">,</span> <span class="n">window_length</span><span class="p">,</span> <span class="n">order_polynome</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y_smooth</span></div>

    <span class="c1">######################################################################################################################################</span>

<div class="viewcode-block" id="Curve.add_feature"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.add_feature">[docs]</a>    <span class="k">def</span> <span class="nf">add_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">add_key</span><span class="p">,</span> <span class="n">add_value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adding features to our &quot;features&quot; dictionary</span>

<span class="sd">        :parameters:</span>
<span class="sd">            add_key:str</span>
<span class="sd">                name of the key to add</span>
<span class="sd">            add_value: str, int, dict, list</span>
<span class="sd">                data structure to add as value to the key</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">add_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_value</span></div>

    <span class="c1">######################################################################################################################################</span>

<div class="viewcode-block" id="Curve.creation_output_curve"><a class="viewcode-back" href="../../model.html#model.class_curve.Curve.creation_output_curve">[docs]</a>    <span class="k">def</span> <span class="nf">creation_output_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key_features</span><span class="p">,</span> <span class="n">value_features</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_features</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">key_dict</span><span class="p">,</span> <span class="n">value_dict</span> <span class="ow">in</span> <span class="n">value_features</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">key_dict</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">key_dict</span> <span class="o">==</span> <span class="n">key_features</span> <span class="ow">or</span> <span class="n">key_features</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">key_dict</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="n">key_features</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_dict</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="n">key_features</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">key_dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_dict</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="n">key_features</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_features</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">hour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">hour</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;Hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;theorical_contact_force (N)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters_header</span><span class="p">[</span><span class="s1">&#39;header_global&#39;</span><span class="p">][</span><span class="s1">&#39;settings.segment.0.setpoint.value&#39;</span><span class="p">]),</span> <span class="s1">&#39;.1E&#39;</span><span class="p">)</span>
        <span class="n">time_segment_pause</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_segments</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;pause&#39;</span><span class="p">:</span>
                <span class="n">time_segment_pause</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.duration&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;time_segment_pause_&#39;</span> <span class="o">+</span> <span class="n">segment</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; (s)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_segment_pause</span>
            <span class="k">elif</span> <span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;motion&#39;</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.length&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;theorical_distance_&#39;</span> <span class="o">+</span> <span class="n">segment</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; (m)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">length</span><span class="p">),</span> <span class="s1">&#39;.1E&#39;</span><span class="p">)</span> 
                <span class="n">freq</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.num-points&#39;</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.duration&#39;</span><span class="p">]),</span> <span class="s1">&#39;.1E&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;theorical_freq_&#39;</span> <span class="o">+</span> <span class="n">segment</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; (Hz)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq</span>
                <span class="n">speed</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.length&#39;</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">header_segment</span><span class="p">[</span><span class="s1">&#39;segment-settings.duration&#39;</span><span class="p">]),</span> <span class="s1">&#39;.1E&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;theorical_speed_&#39;</span> <span class="o">+</span> <span class="n">segment</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; (m/s)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">speed</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Thierry GALLIANO.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>